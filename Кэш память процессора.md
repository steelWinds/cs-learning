**Кэш-память** - это вторая по уровню скорости память, после **регистров**, которая помогает процессору хранить промежуточные данные вычислений между ним и **RAM**.

### Локальность данных
**Локальность данных** - это свойство программы использовать близкие к друг-другу ячейки памяти во время работы, это свойство определяет возможность **кэширования** данных, в связи с их частым использованием. Определяют **два типа** локальности:
 - **Пространственная локальность** - если обращение произошло к ячейке памяти, то высок процент того, что в скором времени обращение произойдет к соседним ячейкам памяти.
 - **Временная локальность** - если произошло обращение к некоторой ячейке памяти, то с высокой вероятностью произойдет обращение к этой же ячейке памяти.

**Организация Кэш-памяти:**
 - **Кэш-линия (cache-line)** - набор смежных слов данных, которые помещаются в кэш или вытесняются из кэша совместно.
 - **Типы отображения данных в кэш:**
	 - Прямое отображение
	 - Наборно-ассоциативное
	 - Полностью ассоциативное
- **Состояние данных в кэш:**
	- cache-miss - данные в кэше отсутсвуют
	- cache-hit - данные в кэше

### Кеш прямого отображения

1. Блоки RAM делятся на **первичные сегменты** равные размеру кеша
2. Первичные сегменты делятся на **вторичные сегменты**, которые в свою очередь составляют размер **кэш-лайна (cache-line)**.
> Cache-line - это размер блока данных к кэше

![[Pasted image 20240121192532.png]]

3. Блоки данных в разных вторичных сегментах, но с одинаковыми номерами закрепляются за определенной кэш-линией
> Это сделано для того, чтобы взятый участок памяти не использовал один и тот-же кэш-лайн и перезаписывал его, тогда смысл от кеширования попросту теряется, так-как кеш должен запоминать значения, для использования в дальнейшем разными участками памяти, а не служить вторым звеном перезаписи при использовании.  

5. Адрес к ячеке памяти состоит из:
	1. **Index** - индекс определенной строки кеша. Вычисляется как $\log_2(\frac{размер кеша (Bit)}{Размер  кэш-линии (Bit)}) = \log_2(Кол-во кеш-линий) = 11 Bit$
	2. **Offset** - используется для сдвига бит при взятии данных из кеша, если нам не нужна вся строка с данными. Вычисляется как $\log_2(Размер кэш-линии) = 5Bit$
	3. **Tag** - тег хранит часть адреса данных из основной памяти для сравнения при взятии данных из кеша. Вычисляется как $Разрядность процессора (размер адресации) - Index - Offset$ 

![[Pasted image 20240121194230.png]]

### Наборно-ассоциативный кэш
Предыдущие принципы верны, кроме одного, в этом случае к служебным данным и таблице добавляется Set.
	- **Set** - набор кеш-линий, которые могут одновременно хранить несколько привязанных значений из разных вторичных сегментов памяти.
![[Pasted image 20240121200307.png]]

Преимущества данного подхода в том, что теперь работая в разных участках памяти и с двуми одинаковыми блоками памяти, привязанных к одной кэш-линии, мы можем не перезаписывать их, а так-же хранить в кэше.
![[Pasted image 20240121200449.png]]

### Полностью-ассоциативный кэш
Полностью ассоциативный кэш представляет собой банальную Map структуру, где любой участок памяти может хранится в любой кеш-линии, при этом так-же необходима ассоциативная таблица, где будут хранится ключи к таблице кэш-памяти и значения по ключу.
![[Pasted image 20240121200957.png]]

### Типы промахов при обращении к кэшу

- **Неизбежный (compulsory)** 
- **Недостаточно памяти (capacity)** - локальность данных больше чем кэш 
- **Конфликты (conflict)** - одновременно находится два совпадения по тегу